<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alerta Urbana - Sistema de Seguridad Ciudadana</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2c3e50;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            body {
                padding: 0;
                margin: 0;
                height: 100vh;
                overflow: hidden;
            }
        }

        .phone-container {
            width: 375px;
            height: 812px;
            background: #000;
            border-radius: 25px;
            padding: 8px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            position: relative;
        }

        @media (max-width: 768px) {
            .phone-container {
                width: 100vw;
                height: 100vh;
                background: transparent;
                border-radius: 0;
                padding: 0;
                box-shadow: none;
            }
        }

        .phone-screen {
            width: 100%;
            height: 100%;
            background: #ffffff;
            border-radius: 18px;
            overflow: hidden;
            position: relative;
        }

        @media (max-width: 768px) {
            .phone-screen {
                border-radius: 0;
            }
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff;
            display: flex;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .screen.active {
            opacity: 1;
            visibility: visible;
        }

        .status-bar {
            height: 44px;
            background: #1e3a8a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            color: white;
            font-size: 14px;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .status-bar {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 1000;
                padding-top: env(safe-area-inset-top);
                height: calc(44px + env(safe-area-inset-top));
            }
        }

        .header {
            background: #1e3a8a;
            color: white;
            padding: 20px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .header {
                margin-top: calc(44px + env(safe-area-inset-top));
            }
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .tech-eye {
            width: 60px;
            height: 35px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: 2px solid #60a5fa;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .tech-pupil {
            width: 16px;
            height: 16px;
            background: #10b981;
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 15px #10b981;
            animation: techPulse 2s infinite ease-in-out;
        }

        .tech-pupil::after {
            content: '';
            width: 5px;
            height: 5px;
            background: #064e3b;
            border-radius: 50%;
            position: absolute;
            top: 5.5px;
            left: 5.5px;
        }

        .scan-line {
            position: absolute;
            width: 100%;
            height: 1.5px;
            background: linear-gradient(90deg, transparent, #10b981, transparent);
            animation: scanAnimation 3s infinite ease-in-out;
        }

        @keyframes techPulse {
            0%, 100% { 
                box-shadow: 0 0 15px #10b981;
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 25px #10b981, 0 0 35px #10b981;
                transform: scale(1.05);
            }
        }

        @keyframes scanAnimation {
            0% { 
                transform: translateY(-15px); 
                opacity: 0; 
            }
            50% { 
                opacity: 1; 
            }
            100% { 
                transform: translateY(15px); 
                opacity: 0; 
            }
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            flex: 1;
            padding: 20px;
            padding-bottom: 85px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .content {
                padding-top: calc(44px + env(safe-area-inset-top));
                padding-bottom: calc(85px + env(safe-area-inset-bottom));
                margin-top: 0;
                /* Safari-specific fix for bottom content visibility */
                margin-bottom: calc(20px + env(safe-area-inset-bottom));
            }
        }

        /* Safari-specific fixes */
        @supports (-webkit-touch-callout: none) {
            @media (max-width: 768px) {
                .content {
                    padding-bottom: calc(100px + env(safe-area-inset-bottom));
                    margin-bottom: calc(30px + env(safe-area-inset-bottom));
                }
                
                .nav-tabs {
                    padding: 12px 0 calc(20px + env(safe-area-inset-bottom));
                }
            }
        }

        /* Additional Safari-specific targeting */
        @media (max-width: 768px) {
            body.safari-browser .content {
                padding-bottom: calc(110px + env(safe-area-inset-bottom)) !important;
                margin-bottom: calc(40px + env(safe-area-inset-bottom)) !important;
            }
            
            body.safari-browser .nav-tabs {
                padding: 15px 0 calc(25px + env(safe-area-inset-bottom)) !important;
            }
        }

            /* Keyboard handling for mobile */
            body.keyboard-open {
                height: auto;
                overflow: auto;
            }
            
            body.keyboard-open .phone-container {
                height: auto;
                min-height: 100vh;
            }
            
            body.keyboard-open .phone-screen {
                height: auto;
                min-height: 100vh;
            }
            
            body.keyboard-open .screen {
                position: relative;
                height: auto;
                min-height: 100vh;
            }
            
            body.keyboard-open .status-bar {
                position: relative;
                padding-top: env(safe-area-inset-top);
                height: calc(44px + env(safe-area-inset-top));
            }
            
            body.keyboard-open .nav-tabs {
                position: relative;
                bottom: auto;
                left: auto;
                right: auto;
                margin-top: 20px;
                padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
            }
            
            body.keyboard-open .header {
                margin-top: 0;
            }
            
            body.keyboard-open .content {
                padding-top: 20px;
                padding-bottom: 20px;
                flex: none;
            }

            /* Safari-specific keyboard mode fixes */
            body.safari-keyboard .content {
                padding-bottom: 40px;
                margin-bottom: 40px;
            }
            
            body.safari-keyboard .nav-tabs {
                margin-top: 40px;
                padding: 12px 0 calc(30px + env(safe-area-inset-bottom));
            }
            
            /* Ensure grid layouts work in keyboard mode */
            body.keyboard-open .quick-actions,
            body.safari-keyboard .quick-actions {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
            }
        }

        .quick-actions {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 15px;
            margin-bottom: 20px;
        }

        /* Desktop: ensure phone container is wide enough for 2x2 grid */
        @media (min-width: 769px) {
            .phone-container {
                width: 450px; /* Wider to accommodate 2x2 grid properly */
            }
            
            /* Force grid layout on desktop with maximum specificity */
            #dashboard .content .quick-actions {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                grid-template-rows: 1fr 1fr !important;
                gap: 15px !important;
                width: 100% !important;
            }
            
            #dashboard .content .quick-actions .action-card {
                width: auto !important;
                max-width: none !important;
                min-width: 0 !important;
            }
            
        }

        /* Ensure quick-actions stays 2x2 on mobile */
        @media (max-width: 768px) {
            .quick-actions {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 15px;
            }
            
            /* Safari-specific override */
            body.safari-browser .quick-actions {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
            }
        }

        .action-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border: 1px solid #e5e7eb;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
        }

        .action-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 24px;
            color: white;
        }

        .emergency-action .action-icon {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .report-action .action-icon {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .cameras-action .action-icon {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .ranking-action .action-icon {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .action-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .action-desc {
            font-size: 12px;
            color: #6b7280;
        }

        .stats-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .stats-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1f2937;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #3b82f6;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }

        .alerts-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .alert-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #fef2f2;
            border-radius: 8px;
            margin-bottom: 8px;
            border-left: 3px solid #ef4444;
            transition: all 0.3s ease;
        }

        .alert-item:last-child {
            margin-bottom: 0;
        }

        .alert-item[data-severity="high"] {
            background: #fef2f2;
            border-left-color: #ef4444;
        }

        .alert-item[data-severity="medium"] {
            background: #fefbf3;
            border-left-color: #f59e0b;
        }

        .alert-item[data-severity="low"] {
            background: #f0fdf4;
            border-left-color: #10b981;
        }

        .alert-item.acknowledged {
            opacity: 0.6 !important;
            background: #f9fafb !important;
            border-left-color: #9ca3af !important;
        }

        .alert-item[data-severity].acknowledged {
            opacity: 0.6 !important;
            background: #f9fafb !important;
            border-left-color: #9ca3af !important;
            filter: grayscale(30%) !important;
        }

        .alert-item.force-acknowledged {
            opacity: 0.6 !important;
            background: #f9fafb !important;
            background-color: #f9fafb !important;
            border-left-color: #9ca3af !important;
            filter: grayscale(50%) !important;
        }

        .alert-severity {
            font-size: 10px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 4px;
            display: inline-block;
        }

        .alert-severity.high {
            background: #fee2e2;
            color: #991b1b;
        }

        .alert-severity.medium {
            background: #fef3c7;
            color: #92400e;
        }

        .alert-severity.low {
            background: #d1fae5;
            color: #065f46;
        }

        .alert-actions {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .alert-btn {
            background: #10b981;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .alert-btn:hover {
            background: #059669;
            transform: scale(1.1);
        }

        .alert-btn.acknowledged {
            background: #9ca3af;
            cursor: default;
        }

        .alert-btn.acknowledged:hover {
            background: #9ca3af;
            transform: none;
        }

        /* Photo upload styles */
        .photo-controls {
            margin-top: 10px;
        }

        .photo-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .photo-btn {
            flex: 1;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .photo-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .photo-btn:active {
            transform: translateY(0);
        }

        .camera-btn {
            background: #10b981;
        }

        .camera-btn:hover {
            background: #059669;
        }

        .photo-preview {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .photo-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        .photo-count {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
        }

        .clear-photos-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .clear-photos-btn:hover {
            background: #dc2626;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }

        .photo-item {
            position: relative;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .photo-item:hover {
            transform: scale(1.02);
        }

        .photo-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
        }

        .photo-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .photo-remove:hover {
            background: #dc2626;
        }

        .photo-info {
            margin-top: 10px;
            text-align: center;
        }

        .photo-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
            background: #f3f4f6;
            border-radius: 8px;
            color: #6b7280;
            font-size: 14px;
        }

        .filter-btn {
            background: #f3f4f6;
            color: #6b7280;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: #e5e7eb;
        }

        .filter-btn.active {
            background: #3b82f6;
            color: white;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { 
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% { 
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% { 
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .alert-info h3 {
            color: #1f2937;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .alert-info p {
            color: #6b7280;
            font-size: 11px;
        }

        .alert-time {
            background: #dc2626;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }

        .camera-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .camera-feed {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .camera-feed:hover {
            transform: translateY(-2px);
        }

        .camera-header {
            padding: 12px 15px;
            background: #1f2937;
            color: white;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }

        .camera-view {
            height: 120px;
            position: relative;
            overflow: hidden;
        }

        .camera-principal {
            background: url('cameras/1.jpg') center/cover no-repeat;
        }

        .camera-lateral {
            background: url('cameras/2.jpg') center/cover no-repeat;
        }

        .camera-residencial {
            background: url('cameras/3.jpg') center/cover no-repeat;
        }

        .emergency-section {
            padding: 20px;
        }

        .emergency-header {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .emergency-header h2 {
            color: #dc2626;
            font-size: 18px;
            margin-bottom: 8px;
        }

        .emergency-header p {
            color: #991b1b;
            font-size: 12px;
        }

        .emergency-contacts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .contact-btn {
            background: white;
            border: 2px solid #e5e7eb;
            padding: 20px 15px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .contact-btn.emergency {
            background: #fee2e2;
            border-color: #fecaca;
            color: #dc2626;
        }

        .contact-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .panic-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            width: 100%;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            transition: all 0.2s;
        }

        .panic-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .audio-btn {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .audio-btn:hover {
            transform: scale(1.05);
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .submit-btn {
            width: 100%;
            background: #1e3a8a;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .submit-btn:hover {
            background: #1e40af;
        }

        .ranking-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #f3f4f6;
        }

        .ranking-item:last-child {
            border-bottom: none;
        }

        .rank-position {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 15px;
        }

        .rank-1 { background: #fbbf24; color: white; }
        .rank-2 { background: #9ca3af; color: white; }
        .rank-3 { background: #d97706; color: white; }
        .rank-other { background: #f3f4f6; color: #6b7280; }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
        }

        .user-reports {
            font-size: 12px;
            color: #6b7280;
            margin-top: 2px;
        }

        .user-points {
            font-size: 18px;
            font-weight: 700;
            color: #3b82f6;
        }

        .nav-tabs {
            position: absolute;
            bottom: 8px;
            left: 8px;
            right: 8px;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 0;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
            height: 65px;
            z-index: 100;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                border-bottom-left-radius: 0;
                border-bottom-right-radius: 0;
                padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
                z-index: 1000;
            }
        }

        .nav-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 5px 8px;
            transition: all 0.2s ease;
            border-radius: 8px;
            flex: 1;
            max-width: 60px;
        }

        .nav-tab.active {
            color: #3b82f6;
        }

        .nav-tab:not(.active) {
            color: #9ca3af;
        }

        .nav-tab:hover {
            background: #f3f4f6;
        }

        .nav-tab.emergency-tab {
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            padding: 0;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
            transform: translateY(-8px);
            flex: none;
        }

        .nav-tab.emergency-tab.active {
            background: #dc2626;
            color: white;
        }

        .nav-tab.emergency-tab:hover {
            background: #dc2626;
            transform: translateY(-10px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
        }

        .nav-tab.emergency-tab .nav-icon {
            font-size: 24px;
            margin-bottom: 0;
        }

        .nav-tab.emergency-tab .nav-label {
            font-size: 9px;
            font-weight: 600;
            margin-top: 2px;
        }

        .nav-icon {
            font-size: 18px;
            margin-bottom: 2px;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 500;
        }

        /* Vista expandida de cámara */
        .expanded-view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .expanded-camera {
            width: 90%;
            height: 70%;
            background: #1f2937;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ef4444;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .camera-expanded-principal {
            background: url('cameras/1.jpg') center/cover no-repeat;
        }

        .camera-expanded-lateral {
            background: url('cameras/2.jpg') center/cover no-repeat;
        }

        .camera-expanded-residencial {
            background: url('cameras/3.jpg') center/cover no-repeat;
        }

        .quick-report-overlay {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            gap: 10px;
        }

        .quick-report-btn {
            flex: 1;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="phone-screen">
            <!-- Pantalla de Login -->
            <div class="screen active" id="login">
                <div class="status-bar">
                    <span>9:41</span>
                    <span>●●●●● Login</span>
                    <span>🔋 85%</span>
                </div>
                <div class="header">
                    <div class="logo-container">
                        <div class="tech-eye">
                            <div class="tech-pupil"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="logo-text">ALERTA URBANA</div>
                    </div>
                    <p>Acceso al Sistema de Seguridad</p>
                </div>
                <div class="content" style="padding-top: 40px;">
                    <div class="form-group">
                        <label class="form-label">Email o Usuario</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="tu@email.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Contraseña</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="••••••••">
                    </div>

                    <div class="form-group" style="margin-bottom: 30px;">
                        <label style="display: flex; align-items: center; font-size: 14px; color: #6b7280;">
                            <input type="checkbox" id="rememberMe" style="margin-right: 8px;">
                            Recordar mi sesión
                        </label>
                    </div>

                    <button class="submit-btn" id="loginBtn" onclick="handleLoginSimple()">🔐 Iniciar Sesión</button>

                    <div style="text-align: center; margin-top: 20px;">
                        <a href="#" id="registerLink" onclick="showRegisterScreen()" style="color: #3b82f6; text-decoration: none; font-size: 14px;">
                            ¿No tienes cuenta? Regístrate aquí
                        </a>
                    </div>

                    <div style="text-align: center; margin-top: 15px;">
                        <a href="#" onclick="showScreen('forgot-password')" style="color: #6b7280; text-decoration: none; font-size: 12px;">
                            ¿Olvidaste tu contraseña?
                        </a>
                    </div>
                </div>
            </div>

            <!-- Pantalla de Registro -->
            <div class="screen" id="register">
                <div class="status-bar">
                    <span>9:41</span>
                    <span>●●●●● Registro</span>
                    <span>🔋 85%</span>
                </div>
                <div class="header">
                    <div class="logo-container">
                        <div class="tech-eye">
                            <div class="tech-pupil"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="logo-text">NUEVO USUARIO</div>
                    </div>
                    <p>Únete a la comunidad de seguridad</p>
                </div>
                <div class="content">
                    <div class="form-group">
                        <label class="form-label">Nombre Completo</label>
                        <input type="text" class="form-input" id="registerName" placeholder="Juan Pérez">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="registerEmail" placeholder="tu@email.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Teléfono</label>
                        <input type="tel" class="form-input" id="registerPhone" placeholder="+1 234 567 8900">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Dirección</label>
                        <input type="text" class="form-input" id="registerAddress" placeholder="Calle 123, Colonia Centro">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Contraseña</label>
                        <input type="password" class="form-input" id="registerPassword" placeholder="••••••••">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirmar Contraseña</label>
                        <input type="password" class="form-input" id="registerConfirmPassword" placeholder="••••••••">
                    </div>

                    <div class="form-group" style="margin-bottom: 30px;">
                        <label style="display: flex; align-items: flex-start; font-size: 12px; color: #6b7280; line-height: 1.4;">
                            <input type="checkbox" id="acceptTerms" style="margin-right: 8px; margin-top: 2px;">
                            Acepto los términos y condiciones y la política de privacidad del sistema de seguridad vecinal
                        </label>
                    </div>

                    <button class="submit-btn" id="registerBtn" onclick="handleRegisterSimple()">📝 Crear Cuenta</button>

                    <div style="text-align: center; margin-top: 20px;">
                        <a href="#" id="loginLink" onclick="showLoginScreen()" style="color: #3b82f6; text-decoration: none; font-size: 14px;">
                            ¿Ya tienes cuenta? Inicia sesión
                        </a>
                    </div>
                </div>
            </div>

            <!-- Pantalla de Perfil de Usuario -->
            <div class="screen" id="profile">
                <div class="status-bar">
                    <span>9:41</span>
                    <span>●●●●● Perfil</span>
                    <span>🔋 85%</span>
                </div>
                <div class="header">
                    <div class="logo-container">
                        <div class="tech-eye">
                            <div class="tech-pupil"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="logo-text">MI PERFIL</div>
                    </div>
                    <p>Información de usuario verificado</p>
                </div>
                <div class="content">
                    <!-- Información del usuario -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: 700; margin-right: 15px;" id="userAvatar">JP</div>
                            <div>
                                <h3 style="font-size: 18px; font-weight: 600; color: #1f2937; margin-bottom: 5px;" id="userName">Juan Pérez</h3>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600;">✓ VERIFICADO</span>
                                    <span style="color: #6b7280; font-size: 12px;">Nivel Principiante</span>
                                </div>
                            </div>
                        </div>
                        
                        <div style="border-top: 1px solid #e5e7eb; padding-top: 15px;">
                            <div style="margin-bottom: 10px;">
                                <div style="font-size: 12px; color: #6b7280;">Email</div>
                                <div style="font-size: 14px; color: #1f2937;" id="userEmail">juan.perez@email.com</div>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <div style="font-size: 12px; color: #6b7280;">Teléfono</div>
                                <div style="font-size: 14px; color: #1f2937;" id="userPhone">+1 234 567 8900</div>
                            </div>
                            <div>
                                <div style="font-size: 12px; color: #6b7280;">Dirección</div>
                                <div style="font-size: 14px; color: #1f2937;" id="userAddress">Calle 123, Colonia Centro</div>
                            </div>
                        </div>
                    </div>

                    <!-- Estadísticas del usuario -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #1f2937;">📊 Mis Estadísticas</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div style="text-align: center; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #3b82f6;">12</div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">Reportes Enviados</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #10b981;">680</div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">Puntos Ganados</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #f59e0b;">45</div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">Días Activo</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #8b5cf6;">15</div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">Posición Ranking</div>
                            </div>
                        </div>
                    </div>

                    <!-- Configuración -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #1f2937;">⚙️ Configuración</h3>
                        
                        <div style="border-bottom: 1px solid #e5e7eb; padding-bottom: 15px; margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 14px; color: #1f2937;">Notificaciones Push</span>
                                <input type="checkbox" id="pushNotifications" checked style="transform: scale(1.2);">
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span style="font-size: 14px; color: #1f2937;">Alertas por Email</span>
                                <input type="checkbox" id="emailAlerts" checked style="transform: scale(1.2);">
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 14px; color: #1f2937;">SMS de Emergencia</span>
                                <input type="checkbox" id="smsAlerts" style="transform: scale(1.2);">
                            </div>
                        </div>

                        <button onclick="editProfile()" style="width: 100%; background: #3b82f6; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 10px;">✏️ Editar Perfil</button>
                        
                        <button onclick="logout()" style="width: 100%; background: #ef4444; color: white; border: none; border-radius: 8px; padding: 12px; font-size: 14px; font-weight: 600; cursor: pointer;">🚪 Cerrar Sesión</button>
                    </div>
                </div>
            </div>

            <!-- Pantalla Principal Dashboard -->
            <div class="screen" id="dashboard">
                <div class="status-bar">
                    <span>9:41</span>
                    <span>●●●●● Alerta Urbana</span>
                    <span>🔋 85%</span>
                </div>
                <div class="header">
                    <div class="logo-container">
                        <div class="tech-eye">
                            <div class="tech-pupil"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="logo-text">ALERTA URBANA</div>
                    </div>
                    <p>Sistema de Monitoreo y Seguridad Urbana</p>
                </div>
                <div class="content">
                    <div class="quick-actions">
                        <div class="action-card emergency-action" data-screen="emergencias">
                            <div class="action-icon">🚨</div>
                            <div class="action-title">Emergencia</div>
                            <div class="action-desc">Llamada inmediata</div>
                        </div>
                        <div class="action-card report-action" data-screen="reportes">
                            <div class="action-icon">📝</div>
                            <div class="action-title">Reportar</div>
                            <div class="action-desc">Enviar incidente</div>
                        </div>
                        <div class="action-card cameras-action" data-screen="camaras">
                            <div class="action-icon">📹</div>
                            <div class="action-title">Cámaras</div>
                            <div class="action-desc">Ver vigilancia</div>
                        </div>
                        <div class="action-card ranking-action" data-screen="ranking">
                            <div class="action-icon">🏆</div>
                            <div class="action-title">Ranking</div>
                            <div class="action-desc">Vecinos activos</div>
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <div class="stats-title">📊 Estado del Sistema</div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-number">3</div>
                                <div class="stat-label">Cámaras Activas</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">5</div>
                                <div class="stat-label">Alertas Hoy</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">98%</div>
                                <div class="stat-label">Tiempo Activo</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">156</div>
                                <div class="stat-label">Vecinos Activos</div>
                            </div>
                        </div>
                    </div>

                    <div class="alerts-section">
                        <div class="stats-title">🚨 Alertas Recientes</div>
                        <div class="alert-item" data-severity="high">
                            <div class="alert-info">
                                <h3>Movimiento Detectado</h3>
                                <p>Zona residencial - Cámara 03</p>
                                <div class="alert-severity high">🔴 ALTA</div>
                            </div>
                            <div class="alert-actions">
                                <div class="alert-time">13:45</div>
                                <button class="alert-btn" onclick="acknowledgeAlert('alert1')">✓</button>
                            </div>
                        </div>
                        <div class="alert-item" data-severity="medium">
                            <div class="alert-info">
                                <h3>Vehículo No Autorizado</h3>
                                <p>Estacionamiento - Cámara 01</p>
                                <div class="alert-severity medium">🟡 MEDIA</div>
                            </div>
                            <div class="alert-actions">
                                <div class="alert-time">12:30</div>
                                <button class="alert-btn" onclick="acknowledgeAlert('alert2')">✓</button>
                            </div>
                        </div>
                        <div class="alert-item acknowledged" data-severity="low">
                            <div class="alert-info">
                                <h3>Persona Sospechosa</h3>
                                <p>Entrada principal - Cámara 01</p>
                                <div class="alert-severity low">🟢 BAJA</div>
                            </div>
                            <div class="alert-actions">
                                <div class="alert-time">11:15</div>
                                <button class="alert-btn acknowledged">✓</button>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 15px;">
                            <button onclick="showScreen('alerts')" style="background: #3b82f6; color: white; border: none; border-radius: 8px; padding: 10px 20px; font-size: 12px; cursor: pointer;">
                                Ver Todas las Alertas
                            </button>
                        </div>
                        
                        <!-- Demo indicator -->
                        <div style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 15px; border-radius: 12px; margin-top: 20px; text-align: center;">
                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">🚀 DEMO INTERACTIVO</div>
                            <div style="font-size: 12px; opacity: 0.9;">Explora todas las funciones de seguridad</div>
                            <div style="font-size: 10px; margin-top: 8px; opacity: 0.8;">Credenciales: demo / demo</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pantalla de Cámaras -->
            <div class="screen" id="camaras">
                <div class="status-bar">
                    <span>9:41</span>
                    <span>●●●●● Cámaras</span>
                    <span>🔋 85%</span>
                </div>
                <div class="header">
                    <div class="logo-container">
                        <div class="tech-eye">
                            <div class="tech-pupil"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="logo-text">CÁMARAS</div>
                    </div>
                    <p>Monitoreo en tiempo real</p>
                </div>
                <div class="content">
                    <div class="camera-grid">
                        <div class="camera-feed" onclick="expandCamera('principal')">
                            <div class="camera-header">
                                <span>📹 Cámara Principal</span>
                                <span>🟢 En vivo</span>
                            </div>
                            <div class="camera-view camera-principal"></div>
                        </div>

                        <div class="camera-feed" onclick="expandCamera('lateral')">
                            <div class="camera-header">
                                <span>📹 Cámara Lateral</span>
                                <span>🟢 En vivo</span>
                            </div>
                            <div class="camera-view camera-lateral"></div>
                        </div>

                        <div class="camera-feed" onclick="expandCamera('residencial')">
                            <div class="camera-header">
                                <span>📹 Cámara Residencial</span>
                                <span>🟢 En vivo</span>
                            </div>
                            <div class="camera-view camera-residencial"></div>
                        </div>
                    </div>

                    <div class="stats-section">
                        <div class="stats-title">🔧 Estado de la Red</div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="text-align: center;">
                                <div style="font-size: 14px; color: #6b7280;">Conexión</div>
                                <div style="font-size: 18px; font-weight: 600; color: #10b981;">Estable</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 14px; color: #6b7280;">Calidad</div>
                                <div style="font-size: 18px; font-weight: 600; color: #10b981;">HD</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 14px; color: #6b7280;">Latencia</div>
                                <div style="font-size: 18px; font-weight: 600; color: #3b82f6;">45ms</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pantalla de Reportes -->
            <div class="screen" id="reportes">
                <div class="status-bar">
                    <span>9:41</span>
                    <span>●●●●● Reporte</span>
                    <span>🔋 85%</span>
                </div>
                <div class="header">
                    <div class="logo-container">
                        <div class="tech-eye">
                            <div class="tech-pupil"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="logo-text">NUEVO REPORTE</div>
                    </div>
                    <p>Describe el incidente observado</p>
                </div>
                <div class="content">
                    <div class="form-group">
                        <label class="form-label">Cámara relacionada</label>
                        <select class="form-select" id="cameraSelect">
                            <option>Seleccionar cámara</option>
                            <option>Cámara Principal - Entrada</option>
                            <option>Cámara Lateral - Parque</option>
                            <option>Cámara Residencial</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ubicación del incidente</label>
                        <input type="text" class="form-input" id="locationInput" placeholder="Dirección o punto de referencia">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Descripción del incidente</label>
                        <textarea class="form-textarea" id="descriptionInput" placeholder="Describe lo que observaste de manera clara y objetiva..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Evidencia fotográfica (opcional)</label>
                        <div class="photo-controls">
                            <div class="photo-buttons">
                                <button type="button" class="photo-btn camera-btn" id="takePhotoBtn">📷 Tomar Foto</button>
                                <button type="button" class="photo-btn upload-btn" id="uploadPhotoBtn">📁 Subir Foto</button>
                            </div>
                            <input type="file" id="photoInput" accept="image/*" capture="environment" style="display: none;">
                            <input type="file" id="uploadInput" accept="image/*" multiple style="display: none;">
                        </div>
                        
                        <!-- Photo preview area -->
                        <div id="photoPreview" class="photo-preview" style="display: none;">
                            <div class="photo-preview-header">
                                <span class="photo-count">0 fotos seleccionadas</span>
                                <button type="button" class="clear-photos-btn" id="clearPhotosBtn">🗑️ Limpiar</button>
                            </div>
                            <div class="photo-grid" id="photoGrid"></div>
                        </div>
                        
                        <div class="photo-info">
                            <span style="font-size: 11px; color: #6b7280;">
                                📸 Máximo 5 fotos • Hasta 5MB cada una • JPG, PNG
                            </span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Grabación de audio (opcional)</label>
                        <div class="audio-controls">
                            <button class="audio-btn" id="recordBtn" onclick="toggleRecording()">🎤</button>
                            <span id="audioTime">00:00</span>
                            <span style="font-size: 12px; color: #6b7280;">Presiona para grabar</span>
                        </div>
                    </div>

                    <button class="submit-btn" id="submitReportBtn" onclick="submitReport()">📤 Enviar Reporte</button>
                </div>
            </div>

            <!-- Pantalla de Emergencias -->
            <div class="screen" id="emergencias">
                <div class="status-bar">
                    <span>9:41</span>
                    <span>●●●●● Emergencia</span>
                    <span>🔋 85%</span>
                </div>
                <div class="header">
                    <div class="logo-container">
                        <div class="tech-eye">
                            <div class="tech-pupil"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="logo-text">EMERGENCIAS</div>
                    </div>
                    <p>Servicios de emergencia inmediata</p>
                </div>
                <div class="emergency-section">
                    <div class="emergency-header">
                        <h2>🚨 Servicios de Emergencia</h2>
                        <p>En caso de emergencia real, utiliza estos botones para contacto inmediato</p>
                    </div>
                    
                    <div class="emergency-contacts">
                        <button class="contact-btn emergency" onclick="emergencyCall('policia')">
                            🚔<br><strong>Policía</strong><br>911
                        </button>
                        <button class="contact-btn emergency" onclick="emergencyCall('ambulancia')">
                            🚑<br><strong>Ambulancia</strong><br>911
                        </button>
                        <button class="contact-btn emergency" onclick="emergencyCall('bomberos')">
                            🚒<br><strong>Bomberos</strong><br>911
                        </button>
                        <button class="contact-btn" onclick="emergencyCall('seguridad')">
                            🛡️<br><strong>Seguridad</strong><br>Local
                        </button>
                    </div>

                    <button class="panic-btn" onclick="panicAlert()">
                        🆘 BOTÓN DE PÁNICO
                    </button>
                </div>
            </div>

            <!-- Pantalla de Ranking -->
            <div class="screen" id="ranking">
                <div class="status-bar">
                    <span>9:41</span>
                    <span>●●●●● Ranking</span>
                    <span>🔋 85%</span>
                </div>
                <div class="header">
                    <div class="logo-container">
                        <div class="tech-eye">
                            <div class="tech-pupil"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="logo-text">RANKING VECINAL</div>
                    </div>
                    <p>Vecinos más activos en seguridad</p>
                </div>
                <div class="content">
                    <div class="ranking-list">
                        <div class="ranking-item">
                            <div class="rank-position rank-1">1</div>
                            <div class="user-info">
                                <div class="user-name">María González</div>
                                <div class="user-reports">45 reportes • Nivel Experto</div>
                            </div>
                            <div class="user-points">2,840</div>
                        </div>
                        <div class="ranking-item">
                            <div class="rank-position rank-2">2</div>
                            <div class="user-info">
                                <div class="user-name">Carlos Mendoza</div>
                                <div class="user-reports">38 reportes • Nivel Avanzado</div>
                            </div>
                            <div class="user-points">2,190</div>
                        </div>
                        <div class="ranking-item">
                            <div class="rank-position rank-3">3</div>
                            <div class="user-info">
                                <div class="user-name">Ana López</div>
                                <div class="user-reports">32 reportes • Nivel Avanzado</div>
                            </div>
                            <div class="user-points">1,865</div>
                        </div>
                        <div class="ranking-item">
                            <div class="rank-position rank-other">4</div>
                            <div class="user-info">
                                <div class="user-name">Roberto Silva</div>
                                <div class="user-reports">28 reportes • Nivel Intermedio</div>
                            </div>
                            <div class="user-points">1,520</div>
                        </div>
                        <div class="ranking-item">
                            <div class="rank-position rank-other">15</div>
                            <div class="user-info">
                                <div class="user-name">Tú</div>
                                <div class="user-reports">12 reportes • Nivel Principiante</div>
                            </div>
                            <div class="user-points">680</div>
                        </div>
                    </div>

                    <div style="background: white; border-radius: 12px; padding: 20px; margin-top: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #1f2937;">🎯 Tu Progreso</h3>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="font-size: 14px; color: #6b7280;">Nivel Principiante</span>
                            <span style="font-size: 14px; color: #6b7280;">680 / 1000 pts</span>
                        </div>
                        <div style="background: #f3f4f6; border-radius: 10px; height: 8px; overflow: hidden;">
                            <div style="background: #3b82f6; height: 100%; width: 68%; border-radius: 10px;"></div>
                        </div>
                        <p style="font-size: 12px; color: #6b7280; margin-top: 10px;">320 puntos para alcanzar Nivel Intermedio</p>
                        
                        <button class="rewards-btn" onclick="showRewards()" style="width: 100%; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; padding: 15px; font-size: 14px; font-weight: 600; cursor: pointer; margin-top: 15px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s;">
                            🎁 Ver Recompensas Disponibles
                        </button>
                    </div>
                </div>
            </div>

            <!-- Pantalla de Recompensas -->
            <div class="screen" id="recompensas">
                <div class="status-bar">
                    <span>9:41</span>
                    <span>●●●●● Recompensas</span>
                    <span>🔋 85%</span>
                </div>
                <div class="header">
                    <div class="logo-container">
                        <div class="tech-eye">
                            <div class="tech-pupil"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="logo-text">RECOMPENSAS</div>
                    </div>
                    <p>Beneficios por tu participación</p>
                </div>
                <div class="content">
                    <!-- Puntos actuales -->
                    <div style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); border-radius: 12px; padding: 20px; margin-bottom: 20px; color: white; text-align: center;">
                        <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">💎 680 Puntos</h3>
                        <p style="font-size: 14px; opacity: 0.9;">Nivel Principiante</p>
                    </div>

                    <!-- Recompensas disponibles -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #1f2937;">🎁 Disponibles Ahora</h3>
                        
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f8fafc;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: #1f2937;">☕ Descuento Cafetería</div>
                                    <div style="font-size: 12px; color: #6b7280;">15% descuento en Café Central</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 14px; font-weight: 700; color: #10b981;">500 pts</div>
                                    <button onclick="claimReward('cafe')" style="background: #10b981; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 12px; cursor: pointer; margin-top: 5px;">Canjear</button>
                                </div>
                            </div>
                        </div>

                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f8fafc;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: #1f2937;">🍕 Descuento Comida</div>
                                    <div style="font-size: 12px; color: #6b7280;">10% en Pizza Express</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 14px; font-weight: 700; color: #10b981;">600 pts</div>
                                    <button onclick="claimReward('pizza')" style="background: #10b981; color: white; border: none; border-radius: 6px; padding: 6px 12px; font-size: 12px; cursor: pointer; margin-top: 5px;">Canjear</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Próximas recompensas -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #1f2937;">🔒 Próximas Recompensas</h3>
                        
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f9fafb; opacity: 0.7;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: #1f2937;">🎬 Entrada Cine</div>
                                    <div style="font-size: 12px; color: #6b7280;">2x1 en Cineplex</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 14px; font-weight: 700; color: #6b7280;">1,000 pts</div>
                                    <div style="font-size: 10px; color: #6b7280;">Faltan 320 pts</div>
                                </div>
                            </div>
                        </div>

                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: #f9fafb; opacity: 0.7;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: #1f2937;">🏪 Vale Supermercado</div>
                                    <div style="font-size: 12px; color: #6b7280;">$20 descuento</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 14px; font-weight: 700; color: #6b7280;">1,500 pts</div>
                                    <div style="font-size: 10px; color: #6b7280;">Faltan 820 pts</div>
                                </div>
                            </div>
                        </div>

                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: #f9fafb; opacity: 0.7;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 14px; font-weight: 600; color: #1f2937;">🏆 Reconocimiento VIP</div>
                                    <div style="font-size: 12px; color: #6b7280;">Certificado oficial</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 14px; font-weight: 700; color: #6b7280;">2,500 pts</div>
                                    <div style="font-size: 10px; color: #6b7280;">Faltan 1,820 pts</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button onclick="showScreen('ranking')" style="width: 100%; background: #6b7280; color: white; border: none; border-radius: 8px; padding: 15px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                        ← Volver al Ranking
                    </button>
                </div>
            </div>

            <!-- Pantalla de Alertas -->
            <div class="screen" id="alerts">
                <div class="status-bar">
                    <span>9:41</span>
                    <span>●●●●● Alertas</span>
                    <span>🔋 85%</span>
                </div>
                <div class="header">
                    <div class="logo-container">
                        <div class="tech-eye">
                            <div class="tech-pupil"></div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="logo-text">CENTRO DE ALERTAS</div>
                    </div>
                    <p>Monitoreo y gestión de incidentes</p>
                </div>
                <div class="content">
                    <!-- Búsqueda y filtros de alertas -->
                    <div style="background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <!-- Barra de búsqueda -->
                        <div style="margin-bottom: 15px;">
                            <div style="position: relative;">
                                <input 
                                    type="text" 
                                    id="alertSearch" 
                                    placeholder="🔍 Buscar alertas..." 
                                    style="width: 100%; padding: 12px 40px 12px 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 14px; background: #f9fafb;"
                                    onkeyup="searchAlerts(this.value)"
                                >
                                <button 
                                    id="clearSearchBtn"
                                    style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #6b7280; cursor: pointer; display: none;"
                                    onclick="clearSearch()"
                                >✕</button>
                            </div>
                        </div>

                        <!-- Filtros por severidad -->
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; display: block;">SEVERIDAD</label>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="filter-btn active" data-filter="all" data-type="severity" onclick="filterAlerts('all', 'severity')">Todas</button>
                                <button class="filter-btn" data-filter="high" data-type="severity" onclick="filterAlerts('high', 'severity')">🔴 Crítica</button>
                                <button class="filter-btn" data-filter="medium" data-type="severity" onclick="filterAlerts('medium', 'severity')">🟡 Media</button>
                                <button class="filter-btn" data-filter="low" data-type="severity" onclick="filterAlerts('low', 'severity')">🟢 Baja</button>
                            </div>
                        </div>

                        <!-- Filtros por estado -->
                        <div style="margin-bottom: 10px;">
                            <label style="font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; display: block;">ESTADO</label>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="filter-btn active" data-filter="all" data-type="status" onclick="filterAlerts('all', 'status')">Todas</button>
                                <button class="filter-btn" data-filter="pending" data-type="status" onclick="filterAlerts('pending', 'status')">⏳ Pendientes</button>
                                <button class="filter-btn" data-filter="acknowledged" data-type="status" onclick="filterAlerts('acknowledged', 'status')">✅ Atendidas</button>
                            </div>
                        </div>

                        <!-- Filtro rápido por tiempo -->
                        <div>
                            <label style="font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; display: block;">TIEMPO</label>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="filter-btn active" data-filter="all" data-type="time" onclick="filterAlerts('all', 'time')">Todo</button>
                                <button class="filter-btn" data-filter="hour" data-type="time" onclick="filterAlerts('hour', 'time')">🕐 Última hora</button>
                                <button class="filter-btn" data-filter="today" data-type="time" onclick="filterAlerts('today', 'time')">📅 Hoy</button>
                                <button class="filter-btn" data-filter="week" data-type="time" onclick="filterAlerts('week', 'time')">📆 Esta semana</button>
                            </div>
                        </div>

                        <!-- Contador de resultados -->
                        <div id="alertsCounter" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb; font-size: 12px; color: #6b7280; text-align: center;">
                            Mostrando <span id="alertsCount">6</span> de <span id="totalAlerts">6</span> alertas
                        </div>
                    </div>

                    <!-- Lista de alertas -->
                    <div id="alertsList">
                        <!-- Alertas Críticas -->
                        <div class="alert-item" data-severity="high" data-status="pending">
                            <div class="alert-info">
                                <h3>🚨 Intrusión Detectada</h3>
                                <p>Perímetro principal - Cámara 01</p>
                                <div style="display: flex; gap: 8px; margin-top: 5px;">
                                    <div class="alert-severity high">🔴 CRÍTICA</div>
                                    <span style="font-size: 10px; color: #6b7280;">hace 2 min</span>
                                </div>
                            </div>
                            <div class="alert-actions">
                                <div class="alert-time">15:23</div>
                                <button class="alert-btn" onclick="acknowledgeAlert('alert_critical_1')" title="Marcar como atendida">✓</button>
                                <button class="alert-btn" onclick="viewAlertDetails('alert_critical_1')" style="background: #3b82f6; margin-top: 4px;" title="Ver detalles">👁️</button>
                            </div>
                        </div>

                        <div class="alert-item" data-severity="high" data-status="pending">
                            <div class="alert-info">
                                <h3>Movimiento Detectado</h3>
                                <p>Zona residencial - Cámara 03</p>
                                <div style="display: flex; gap: 8px; margin-top: 5px;">
                                    <div class="alert-severity high">🔴 ALTA</div>
                                    <span style="font-size: 10px; color: #6b7280;">hace 12 min</span>
                                </div>
                            </div>
                            <div class="alert-actions">
                                <div class="alert-time">13:45</div>
                                <button class="alert-btn" onclick="acknowledgeAlert('alert1')">✓</button>
                                <button class="alert-btn" onclick="viewAlertDetails('alert1')" style="background: #3b82f6; margin-top: 4px;">👁️</button>
                            </div>
                        </div>

                        <div class="alert-item" data-severity="medium" data-status="pending">
                            <div class="alert-info">
                                <h3>Vehículo No Autorizado</h3>
                                <p>Estacionamiento - Cámara 01</p>
                                <div style="display: flex; gap: 8px; margin-top: 5px;">
                                    <div class="alert-severity medium">🟡 MEDIA</div>
                                    <span style="font-size: 10px; color: #6b7280;">hace 1h 15min</span>
                                </div>
                            </div>
                            <div class="alert-actions">
                                <div class="alert-time">12:30</div>
                                <button class="alert-btn" onclick="acknowledgeAlert('alert2')">✓</button>
                                <button class="alert-btn" onclick="viewAlertDetails('alert2')" style="background: #3b82f6; margin-top: 4px;">👁️</button>
                            </div>
                        </div>

                        <div class="alert-item acknowledged" data-severity="low" data-status="acknowledged">
                            <div class="alert-info">
                                <h3>Persona Sospechosa</h3>
                                <p>Entrada principal - Cámara 01</p>
                                <div style="display: flex; gap: 8px; margin-top: 5px;">
                                    <div class="alert-severity low">🟢 BAJA</div>
                                    <span style="font-size: 10px; color: #6b7280;">hace 2h 30min</span>
                                </div>
                            </div>
                            <div class="alert-actions">
                                <div class="alert-time">11:15</div>
                                <button class="alert-btn acknowledged">✓</button>
                                <button class="alert-btn" onclick="viewAlertDetails('alert3')" style="background: #6b7280; margin-top: 4px;">👁️</button>
                            </div>
                        </div>

                        <div class="alert-item" data-severity="medium" data-status="pending">
                            <div class="alert-info">
                                <h3>Puerta Abierta Detectada</h3>
                                <p>Acceso lateral - Sensor 02</p>
                                <div style="display: flex; gap: 8px; margin-top: 5px;">
                                    <div class="alert-severity medium">🟡 MEDIA</div>
                                    <span style="font-size: 10px; color: #6b7280;">hace 3h 45min</span>
                                </div>
                            </div>
                            <div class="alert-actions">
                                <div class="alert-time">10:00</div>
                                <button class="alert-btn" onclick="acknowledgeAlert('alert4')">✓</button>
                                <button class="alert-btn" onclick="viewAlertDetails('alert4')" style="background: #3b82f6; margin-top: 4px;">👁️</button>
                            </div>
                        </div>

                        <div class="alert-item acknowledged" data-severity="low" data-status="acknowledged">
                            <div class="alert-info">
                                <h3>Actividad Normal</h3>
                                <p>Patrullaje de seguridad - Cámara 02</p>
                                <div style="display: flex; gap: 8px; margin-top: 5px;">
                                    <div class="alert-severity low">🟢 BAJA</div>
                                    <span style="font-size: 10px; color: #6b7280;">hace 5h 20min</span>
                                </div>
                            </div>
                            <div class="alert-actions">
                                <div class="alert-time">08:25</div>
                                <button class="alert-btn acknowledged">✓</button>
                                <button class="alert-btn" onclick="viewAlertDetails('alert5')" style="background: #6b7280; margin-top: 4px;">👁️</button>
                            </div>
                        </div>

                        <div class="alert-item" data-severity="low" data-status="pending">
                            <div class="alert-info">
                                <h3>Mantenimiento Programado</h3>
                                <p>Sistema de cámaras - Zona A</p>
                                <div style="display: flex; gap: 8px; margin-top: 5px;">
                                    <div class="alert-severity low">🟢 BAJA</div>
                                    <span style="font-size: 10px; color: #6b7280;">ayer</span>
                                </div>
                            </div>
                            <div class="alert-actions">
                                <div class="alert-time">14:30</div>
                                <button class="alert-btn" onclick="acknowledgeAlert('alert6')">✓</button>
                                <button class="alert-btn" onclick="viewAlertDetails('alert6')" style="background: #3b82f6; margin-top: 4px;">👁️</button>
                            </div>
                        </div>
                    </div>

                    <!-- Estadísticas de alertas -->
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-top: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: #1f2937;">📊 Resumen del Día</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <div style="text-align: center; padding: 15px; background: #fef2f2; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #ef4444;">3</div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">Alertas Críticas</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #fefbf3; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #f59e0b;">5</div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">Alertas Medias</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f0fdf4; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #10b981;">12</div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">Alertas Bajas</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f3f4f6; border-radius: 8px;">
                                <div style="font-size: 24px; font-weight: 700; color: #6b7280;">7</div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">Atendidas</div>
                            </div>
                        </div>
                    </div>

                    <button onclick="showScreen('dashboard')" style="width: 100%; background: #6b7280; color: white; border: none; border-radius: 8px; padding: 15px; font-size: 14px; font-weight: 600; cursor: pointer; margin-top: 20px; transition: all 0.2s;">
                        ← Volver al Dashboard
                    </button>
                </div>
            </div>

            <!-- Navegación -->
            <div class="nav-tabs" id="mainNavigation" style="display: none;">
                <div class="nav-tab active" data-screen="dashboard">
                    <div class="nav-icon">🏠</div>
                    <div class="nav-label">Inicio</div>
                </div>
                <div class="nav-tab" data-screen="camaras">
                    <div class="nav-icon">📹</div>
                    <div class="nav-label">Cámaras</div>
                </div>
                <div class="nav-tab emergency-tab" data-screen="emergencias">
                    <div class="nav-icon">🚨</div>
                    <div class="nav-label">SOS</div>
                </div>
                <div class="nav-tab" data-screen="reportes">
                    <div class="nav-icon">📝</div>
                    <div class="nav-label">Reportes</div>
                </div>
                <div class="nav-tab" data-screen="profile">
                    <div class="nav-icon">👤</div>
                    <div class="nav-label">Perfil</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vista expandida de cámaras -->
    <div class="expanded-view" id="expandedView">
        <div class="expanded-camera" id="expandedCamera">
            <button class="close-btn" onclick="closeCamera()">×</button>
            <div class="quick-report-overlay">
                <button class="quick-report-btn" onclick="quickReport()">📸 Captura</button>
                <button class="quick-report-btn" onclick="emergencyReport()">🚨 Emergencia</button>
            </div>
        </div>
    </div>

    <!-- Test script -->
    <script>
        console.log('Test script loading...');

        // ALERT FILTER FUNCTIONS - DEFINED FIRST FOR IMMEDIATE ACCESS
        var currentFilters = {
            severity: 'all',
            status: 'all',
            time: 'all',
            search: ''
        };

        function filterAlerts(filter, type) {
            console.log('filterAlerts called with:', filter, type);
            if (!type) type = 'severity';
            
            currentFilters[type] = filter;
            
            // Update button states
            var buttons = document.querySelectorAll('[data-type="' + type + '"]');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            
            var activeBtn = document.querySelector('[data-filter="' + filter + '"][data-type="' + type + '"]');
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // Apply filters
            var alertItems = document.querySelectorAll('#alertsList .alert-item');
            var visibleCount = 0;
            
            for (var i = 0; i < alertItems.length; i++) {
                var item = alertItems[i];
                var show = true;
                
                if (currentFilters.severity !== 'all') {
                    show = show && item.getAttribute('data-severity') === currentFilters.severity;
                }
                
                if (currentFilters.status !== 'all') {
                    var itemStatus = item.getAttribute('data-status');
                    show = show && itemStatus === currentFilters.status;
                    
                    // Debug logging for problematic alerts
                    if (item.querySelector('h3').textContent.includes('Movimiento') || item.querySelector('h3').textContent.includes('Vehículo')) {
                        console.log('Filter debug - Alert:', item.querySelector('h3').textContent, 'Status:', itemStatus, 'Expected:', currentFilters.status, 'Show:', show);
                        console.log('Filter debug - Element modified by acknowledge:', item.getAttribute('data-modified-by-acknowledge'));
                        console.log('Filter debug - DOM pointer:', item);
                    }
                }
                
                // Time filtering
                if (currentFilters.time !== 'all') {
                    var timeSpans = item.querySelectorAll('span');
                    var timeText = '';
                    console.log('Checking spans for alert:', item.querySelector('h3').textContent);
                    
                    for (var j = 0; j < timeSpans.length; j++) {
                        var span = timeSpans[j];
                        console.log('  Span', j, 'content:', '"' + span.textContent + '"');
                        if (span.textContent.includes('min') || span.textContent.includes('h') || span.textContent.includes('ayer')) {
                            timeText = span.textContent.toLowerCase();
                            console.log('  Found time span:', '"' + timeText + '"');
                            break;
                        }
                    }
                    
                    console.log('Time filter - Alert:', item.querySelector('h3').textContent, 'Time text:', '"' + timeText + '"', 'Filter:', currentFilters.time);
                    
                    switch(currentFilters.time) {
                        case 'hour':
                            // Only show alerts from the last hour (under 60 minutes)
                            var isWithinHour = false;
                            
                            // More specific pattern matching for hour indicators
                            // Look for patterns like "1h", "2h", etc. (number followed by h)
                            var hasHours = timeText.match(/\d+h/) || timeText.includes(' h ') || timeText.includes('h ');
                            console.log('  Checking time:', '"' + timeText + '"', 'includes min?', timeText.includes('min'), 'has hours?', hasHours);
                            
                            if (timeText.includes('min') && !hasHours) {
                                // Pure minutes like "hace 2 min", "hace 12 min" - these are within the hour
                                isWithinHour = true;
                                console.log('  Pure minutes - Setting isWithinHour = true');
                            } else if (hasHours) {
                                // Anything with hours ("hace 1h", "hace 1h 15min", "hace 3h") is over 1 hour
                                isWithinHour = false;
                                console.log('  Has hours - Setting isWithinHour = false');
                            }
                            
                            show = show && isWithinHour;
                            console.log('Hour filter result for "' + timeText + '":', isWithinHour);
                            break;
                        case 'today':
                            show = show && !timeText.includes('ayer');
                            break;
                        case 'week':
                            // Don't override other filters - just allow all times
                            // show = true; // REMOVED - this was breaking combination filters
                            break;
                    }
                }
                
                if (currentFilters.search) {
                    var title = item.querySelector('h3').textContent.toLowerCase();
                    var desc = item.querySelector('p').textContent.toLowerCase();
                    show = show && (title.includes(currentFilters.search) || desc.includes(currentFilters.search));
                }
                
                item.style.display = show ? 'flex' : 'none';
                if (show) visibleCount++;
            }
            
            // Update counter
            var countEl = document.getElementById('alertsCount');
            var totalEl = document.getElementById('totalAlerts');
            if (countEl) countEl.textContent = visibleCount;
            if (totalEl) totalEl.textContent = alertItems.length;
            
            console.log('Filter applied. Showing', visibleCount, 'of', alertItems.length, 'alerts');
        }

        function acknowledgeAlert(alertId) {
            console.log('acknowledgeAlert called with:', alertId);
            
            // Find the acknowledge button ONLY within the alerts screen to avoid duplicates
            var alertBtn = document.querySelector('#alerts [onclick="acknowledgeAlert(\'' + alertId + '\')"]');
            if (!alertBtn) {
                alertBtn = document.querySelector('#alerts [onclick*="acknowledgeAlert(\'' + alertId + '\')"]');
            }
            
            if (!alertBtn) {
                console.error('Button not found for alert:', alertId);
                return;
            }
            
            var alertItem = alertBtn.closest('.alert-item');
            if (!alertItem) {
                console.error('Alert item not found');
                return;
            }
            
            // Check if already acknowledged
            if (alertBtn.classList.contains('acknowledged')) {
                console.log('Alert already acknowledged');
                return;
            }
            
            console.log('Found alert item for styling:', alertItem);
            console.log('Alert item ID/classes before:', alertItem.className, alertItem.id);
            console.log('Alert item DOM pointer:', alertItem);
            
            // Add a unique identifier to track this specific element
            alertItem.setAttribute('data-modified-by-acknowledge', 'true');
            
            // Mark as acknowledged
            alertItem.classList.add('acknowledged');
            alertItem.setAttribute('data-status', 'acknowledged');
            alertBtn.classList.add('acknowledged');
            
            // Use DOM replacement method that works for problematic alerts
            var originalHTML = alertItem.innerHTML;
            
            // Temporarily replace with acknowledged version
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = originalHTML;
            
            // Modify the content to show acknowledged state
            var h3 = tempDiv.querySelector('h3');
            if (h3 && !h3.textContent.includes('✅')) {
                h3.textContent = '✅ ' + h3.textContent;
            }
            
            // Replace the content and apply acknowledged styling
            alertItem.innerHTML = tempDiv.innerHTML;
            alertItem.style.cssText = 'opacity: 0.6 !important; background: #f9fafb !important; background-color: #f9fafb !important; background-image: none !important; border-left: 4px solid #9ca3af !important; filter: grayscale(50%) !important; transform: scale(0.98) !important;';
            
            // Force browser repaint
            alertItem.offsetHeight;
            
            console.log('Styling applied. Alert item classes after:', alertItem.className);
            console.log('Alert item style attribute:', alertItem.getAttribute('style'));
            
            // Title already updated above via DOM replacement
            
            // Disable and style the button
            alertBtn.onclick = null;
            alertBtn.style.background = '#9ca3af';
            alertBtn.style.cursor = 'default';
            alertBtn.removeAttribute('title');
            
            var title = alertItem.querySelector('h3').textContent;
            alert('✅ Alerta reconocida: ' + title);
            
            // Also update the corresponding dashboard alert copy
            var dashboardAlerts = document.querySelectorAll('#dashboard [onclick*="' + alertId + '"]');
            dashboardAlerts.forEach(function(dashBtn) {
                var dashAlertItem = dashBtn.closest('.alert-item');
                if (dashAlertItem) {
                    dashAlertItem.classList.add('acknowledged');
                    dashAlertItem.setAttribute('data-status', 'acknowledged');
                    dashAlertItem.style.cssText = 'opacity: 0.6 !important; background: #f9fafb !important; filter: grayscale(50%) !important;';
                    
                    // Update dashboard title
                    var dashH3 = dashAlertItem.querySelector('h3');
                    if (dashH3 && !dashH3.textContent.includes('✅')) {
                        dashH3.textContent = '✅ ' + dashH3.textContent;
                    }
                    
                    // Disable dashboard button
                    dashBtn.style.background = '#9ca3af';
                    dashBtn.onclick = null;
                    
                    console.log('Dashboard alert also updated for:', alertId);
                }
            });
            
            // Reapply filters to update counts
            if (window.filterAlerts && typeof currentFilters !== 'undefined') {
                filterAlerts(currentFilters.severity, 'severity');
            }
            
            console.log('Alert acknowledged successfully for:', alertId);
        }

        function searchAlerts(term) {
            currentFilters.search = term.toLowerCase();
            filterAlerts(currentFilters.severity, 'severity');
        }

        function clearSearch() {
            document.getElementById('alertSearch').value = '';
            currentFilters.search = '';
            filterAlerts(currentFilters.severity, 'severity');
        }

        // Make functions global immediately
        window.filterAlerts = filterAlerts;
        window.acknowledgeAlert = acknowledgeAlert;
        window.searchAlerts = searchAlerts;
        window.clearSearch = clearSearch;
        
        function handleLoginSimple() {
            console.log('Login function called');
            var email = document.getElementById('loginEmail').value;
            var password = document.getElementById('loginPassword').value;
            
            console.log('Email:', email, 'Password:', password);
            
            if (!email || !password) {
                alert('Por favor ingresa tu email y contraseña.');
                return;
            }

            if (email === 'demo' && password === 'demo') {
                // Remove keyboard-open class and ensure proper layout
                document.body.classList.remove('keyboard-open');
                
                // Blur any focused inputs to close keyboard
                document.activeElement.blur();
                
                // Scroll to top
                window.scrollTo(0, 0);
                
                alert('¡Login exitoso!');
                
                // Hide login screen
                document.getElementById('login').classList.remove('active');
                // Show dashboard
                document.getElementById('dashboard').classList.add('active');
                // Show navigation
                document.getElementById('mainNavigation').style.display = 'flex';
                // Setup event listeners after login
                setupEventListeners();
                
                // Ensure proper layout after login
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
            } else {
                alert('Credenciales incorrectas.\n\nUsa:\nEmail: demo\nPassword: demo');
            }
        }

        function handleRegisterSimple() {
            console.log('Register function called');
            var name = document.getElementById('registerName').value;
            var email = document.getElementById('registerEmail').value;
            var phone = document.getElementById('registerPhone').value;
            var address = document.getElementById('registerAddress').value;
            var password = document.getElementById('registerPassword').value;
            var confirmPassword = document.getElementById('registerConfirmPassword').value;
            var acceptTerms = document.getElementById('acceptTerms').checked;

            if (!name || !email || !phone || !address || !password || !confirmPassword) {
                alert('Por favor completa todos los campos.');
                return;
            }

            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden.');
                return;
            }

            if (!acceptTerms) {
                alert('Debes aceptar los términos y condiciones.');
                return;
            }

            alert('¡Cuenta creada exitosamente!');
            // Hide register screen
            document.getElementById('register').classList.remove('active');
            // Show dashboard
            document.getElementById('dashboard').classList.add('active');
            // Show navigation
            document.getElementById('mainNavigation').style.display = 'flex';
            // Setup event listeners after login
            setupEventListeners();
        }

        function showRegisterScreen() {
            console.log('Showing register screen');
            document.getElementById('login').classList.remove('active');
            document.getElementById('register').classList.add('active');
        }

        function showLoginScreen() {
            console.log('Showing login screen');
            document.getElementById('register').classList.remove('active');
            document.getElementById('login').classList.add('active');
        }

        function showScreen(screenId) {
            console.log('Showing screen:', screenId);
            document.querySelectorAll('.screen').forEach(function(screen) {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // Dashboard navigation functions
        function showScreen(screenId) {
            console.log('Showing screen:', screenId);
            document.querySelectorAll('.screen').forEach(function(screen) {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // Update navigation tabs
            document.querySelectorAll('.nav-tab').forEach(function(tab) {
                tab.classList.remove('active');
            });
            var activeTab = document.querySelector('[data-screen="' + screenId + '"]');
            if (activeTab && activeTab.classList.contains('nav-tab')) {
                activeTab.classList.add('active');
            }
        }

        // Camera functions
        function expandCamera(type) {
            console.log('Expanding camera:', type);
            var expandedView = document.getElementById('expandedView');
            var expandedCamera = document.getElementById('expandedCamera');
            
            // Clear previous classes
            expandedCamera.className = 'expanded-camera';
            
            // Add specific class
            expandedCamera.classList.add('camera-expanded-' + type);
            
            // Show expanded view
            expandedView.style.display = 'flex';
        }

        function closeCamera() {
            console.log('Closing camera');
            var expandedView = document.getElementById('expandedView');
            expandedView.style.display = 'none';
        }

        // Emergency functions
        function emergencyCall(type) {
            var messages = {
                policia: '🚔 LLAMADA DE EMERGENCIA - POLICÍA\n\nConectando con 911...\nTiempo estimado de respuesta: 5-8 minutos',
                ambulancia: '🚑 LLAMADA DE EMERGENCIA - AMBULANCIA\n\nConectando con 911...\nTiempo estimado de respuesta: 6-10 minutos',
                bomberos: '🚒 LLAMADA DE EMERGENCIA - BOMBEROS\n\nConectando con 911...\nTiempo estimado de respuesta: 4-7 minutos',
                seguridad: '🛡️ LLAMADA A SEGURIDAD LOCAL\n\nConectando con equipo de seguridad...\nTiempo estimado de respuesta: 2-5 minutos'
            };
            
            if (confirm('¿Confirmas que deseas realizar esta llamada de emergencia?')) {
                alert(messages[type]);
            }
        }

        function panicAlert() {
            if (confirm('¿Confirmas que deseas activar la ALERTA DE PÁNICO?')) {
                alert('🚨 ALERTA DE PÁNICO ACTIVADA\n\nSe ha enviado tu ubicación a:\n• Contactos de emergencia\n• Autoridades locales\n• Sistema de seguridad\n\nAyuda en camino.');
            }
        }

        // Report functions
        function submitReport() {
            var camera = document.getElementById('cameraSelect').value;
            var location = document.getElementById('locationInput').value;
            var description = document.getElementById('descriptionInput').value;
            
            if (!camera || camera === 'Seleccionar cámara') {
                alert('Por favor selecciona una cámara.');
                return;
            }
            
            if (!location.trim()) {
                alert('Por favor ingresa la ubicación del incidente.');
                return;
            }
            
            if (!description.trim()) {
                alert('Por favor describe el incidente.');
                return;
            }
            
            var btn = document.getElementById('submitReportBtn');
            var originalText = btn.textContent;
            
            btn.textContent = 'Enviando...';
            btn.disabled = true;
            btn.style.background = '#9ca3af';
            
            setTimeout(function() {
                btn.textContent = '✓ Enviado';
                btn.style.background = '#10b981';
                
                setTimeout(function() {
                    btn.textContent = originalText;
                    btn.disabled = false;
                    btn.style.background = '#1e3a8a';
                    
                    // Clear form
                    document.getElementById('cameraSelect').value = 'Seleccionar cámara';
                    document.getElementById('locationInput').value = '';
                    document.getElementById('descriptionInput').value = '';
                    
                    showScreen('dashboard');
                }, 1500);
            }, 2000);
        }

        // Alert functions

        // Profile functions
        function editProfile() {
            alert('Función de editar perfil en desarrollo.\n\nPróximamente podrás actualizar tu información personal, foto de perfil y configuraciones de seguridad.');
        }

        function logout() {
            if (confirm('¿Estás seguro que deseas cerrar sesión?')) {
                // Hide navigation
                document.getElementById('mainNavigation').style.display = 'none';
                // Show login screen
                showScreen('login');
                alert('Sesión cerrada exitosamente.');
            }
        }

        // Ranking functions
        function showRewards() {
            showScreen('recompensas');
        }

        function claimReward(type) {
            var rewards = {
                cafe: { name: 'Descuento Cafetería', points: 500, description: '15% descuento en Café Central' },
                pizza: { name: 'Descuento Comida', points: 600, description: '10% en Pizza Express' }
            };
            
            var reward = rewards[type];
            var currentPoints = 680;
            
            if (currentPoints >= reward.points) {
                if (confirm('¿Confirmas que deseas canjear ' + reward.points + ' puntos por:\n' + reward.name + '\n' + reward.description + '?')) {
                    alert('🎉 ¡Recompensa canjeada exitosamente!\n\n' + reward.name + '\n' + reward.description + '\n\nCódigo: ALU' + Math.random().toString(36).substr(2, 6).toUpperCase() + '\n\nPuntos restantes: ' + (currentPoints - reward.points));
                }
            } else {
                alert('No tienes suficientes puntos para esta recompensa.\nNecesitas: ' + reward.points + ' puntos\nTienes: ' + currentPoints + ' puntos');
            }
        }

        // Quick actions for cameras
        function quickReport() {
            alert('📸 Captura realizada\nFecha: ' + new Date().toLocaleString() + '\nCámara: Expandida\n\nImagen guardada en reportes.');
        }

        function emergencyReport() {
            if (confirm('¿Deseas enviar un reporte de emergencia desde esta cámara?')) {
                alert('🚨 REPORTE DE EMERGENCIA ENVIADO\n\nUbicación: Cámara actual\nHora: ' + new Date().toLocaleTimeString() + '\n\nAutoridades notificadas.');
            }
        }

        // Photo management
        var selectedPhotos = [];
        var maxPhotos = 5;
        var maxFileSize = 5 * 1024 * 1024; // 5MB

        // Función para configurar listeners de fotos
        function setupPhotoListeners() {
            const takePhotoBtn = document.getElementById('takePhotoBtn');
            const uploadPhotoBtn = document.getElementById('uploadPhotoBtn');
            const photoInput = document.getElementById('photoInput');
            const uploadInput = document.getElementById('uploadInput');

            if (takePhotoBtn) {
                takePhotoBtn.addEventListener('click', handlePhotoCapture);
            }

            if (uploadPhotoBtn) {
                uploadPhotoBtn.addEventListener('click', () => uploadInput.click());
            }

            if (photoInput) {
                photoInput.addEventListener('change', (e) => processFiles(e.target.files));
            }

            if (uploadInput) {
                uploadInput.addEventListener('change', (e) => processFiles(e.target.files));
            }
        }

        // Función para manejar captura de foto
        function handlePhotoCapture() {
            if (selectedPhotos.length >= maxPhotos) {
                alert(`Máximo ${maxPhotos} fotos permitidas`);
                return;
            }

            const photoInput = document.getElementById('photoInput');
            if (photoInput) {
                photoInput.click();
            }
        }

        // Función para procesar archivos seleccionados
        function processFiles(files) {
            for (let file of files) {
                if (selectedPhotos.length >= maxPhotos) {
                    alert(`Máximo ${maxPhotos} fotos permitidas`);
                    break;
                }

                if (validatePhoto(file)) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const photoData = {
                            id: Date.now() + Math.random(),
                            file: file,
                            dataUrl: e.target.result,
                            name: file.name,
                            size: file.size
                        };
                        selectedPhotos.push(photoData);
                        updatePhotoPreview();
                    };
                    reader.readAsDataURL(file);
                }
            }
        }

        // Función para validar fotos
        function validatePhoto(file) {
            if (!file.type.startsWith('image/')) {
                alert('Solo se permiten archivos de imagen');
                return false;
            }

            if (file.size > maxFileSize) {
                alert(`La imagen debe ser menor a ${maxFileSize / (1024 * 1024)}MB`);
                return false;
            }

            return true;
        }

        // Función para actualizar preview de fotos
        function updatePhotoPreview() {
            const container = document.querySelector('.photo-controls');
            if (!container) return;
            
            let previewContainer = container.querySelector('.photo-preview');
            
            if (!previewContainer) {
                previewContainer = document.createElement('div');
                previewContainer.className = 'photo-preview';
                container.appendChild(previewContainer);
            }

            previewContainer.innerHTML = '';

            selectedPhotos.forEach((photo, index) => {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'photo-item';
                photoDiv.innerHTML = `
                    <img src="${photo.dataUrl}" alt="Foto ${index + 1}">
                    <div class="photo-info">
                        <span class="photo-name">${photo.name}</span>
                        <span class="photo-size">${(photo.size / 1024).toFixed(1)}KB</span>
                    </div>
                    <button type="button" class="photo-remove" onclick="removePhoto(${photo.id})">×</button>
                `;
                previewContainer.appendChild(photoDiv);
            });

            // Actualizar contador
            const photoButtons = container.querySelector('.photo-buttons');
            if (photoButtons) {
                let counter = photoButtons.querySelector('.photo-counter');
                if (!counter) {
                    counter = document.createElement('span');
                    counter.className = 'photo-counter';
                    photoButtons.appendChild(counter);
                }
                counter.textContent = `${selectedPhotos.length}/${maxPhotos} fotos`;
            }
        }

        // Función para remover foto
        function removePhoto(photoId) {
            selectedPhotos = selectedPhotos.filter(photo => photo.id !== photoId);
            updatePhotoPreview();
        }

        // Setup event listeners after login
        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            // Photo upload event listeners
            setupPhotoListeners();
            
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(function(tab) {
                tab.addEventListener('click', function() {
                    console.log('Nav tab clicked:', this.getAttribute('data-screen'));
                    var screenId = this.getAttribute('data-screen');
                    if (screenId) {
                        showScreen(screenId);
                    }
                });
            });

            // Action cards in dashboard
            document.querySelectorAll('.action-card').forEach(function(card) {
                card.addEventListener('click', function() {
                    console.log('Action card clicked:', this.getAttribute('data-screen'));
                    var screenId = this.getAttribute('data-screen');
                    if (screenId) {
                        showScreen(screenId);
                    }
                });
            });

            // Camera feeds
            document.querySelectorAll('.camera-feed').forEach(function(feed) {
                feed.addEventListener('click', function() {
                    var onclick = this.getAttribute('onclick');
                    if (onclick && onclick.includes('expandCamera')) {
                        var type = onclick.match(/expandCamera\('(\w+)'\)/)[1];
                        expandCamera(type);
                    }
                });
            });

            // Escape key to close camera
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeCamera();
                }
            });

            // Click outside to close camera
            var expandedView = document.getElementById('expandedView');
            if (expandedView) {
                expandedView.addEventListener('click', function(event) {
                    if (event.target === this) {
                        closeCamera();
                    }
                });
            }

            console.log('Event listeners setup complete');
        }

        console.log('All functions defined successfully');
    </script>
    
    <script>
        console.log('Main script starting...');
        
        // Global variables
        var currentSection = 'dashboard';
        var isRecording = false;
        var recordingTime = 0;
        var recordingInterval;
        var isLoggedIn = false;
        var currentUser = null;

        // Define functions in global scope
        window.showRegisterScreen = function() {
            console.log('Showing register screen');
            document.getElementById('login').classList.remove('active');
            document.getElementById('register').classList.add('active');
        };

        window.showLoginScreen = function() {
            console.log('Showing login screen');
            document.getElementById('register').classList.remove('active');
            document.getElementById('login').classList.add('active');
        };

        window.showDashboard = function() {
            console.log('Showing dashboard');
            document.getElementById('login').classList.remove('active');
            document.getElementById('register').classList.remove('active');
            document.getElementById('dashboard').classList.add('active');
            document.getElementById('mainNavigation').style.display = 'flex';
        };

        window.handleLoginSimple = function() {
            console.log('Login function called');
            var email = document.getElementById('loginEmail').value;
            var password = document.getElementById('loginPassword').value;
            
            console.log('Email:', email, 'Password:', password);
            
            if (!email || !password) {
                alert('Por favor ingresa tu email y contraseña.');
                return;
            }

            if (email === 'demo' && password === 'demo') {
                alert('¡Login exitoso!');
                isLoggedIn = true;
                window.showDashboard();
            } else {
                alert('Credenciales incorrectas.\n\nUsa:\nEmail: demo\nPassword: demo');
            }
        };

        window.handleRegisterSimple = function() {
            console.log('Register function called');
            var name = document.getElementById('registerName').value;
            var email = document.getElementById('registerEmail').value;
            var phone = document.getElementById('registerPhone').value;
            var address = document.getElementById('registerAddress').value;
            var password = document.getElementById('registerPassword').value;
            var confirmPassword = document.getElementById('registerConfirmPassword').value;
            var acceptTerms = document.getElementById('acceptTerms').checked;

            if (!name || !email || !phone || !address || !password || !confirmPassword) {
                alert('Por favor completa todos los campos.');
                return;
            }

            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden.');
                return;
            }

            if (!acceptTerms) {
                alert('Debes aceptar los términos y condiciones.');
                return;
            }

            alert('¡Cuenta creada exitosamente!');
            isLoggedIn = true;
            window.showDashboard();
        };

        console.log('Functions defined successfully');

        // Función principal para cambiar pantallas
        function showScreen(screenId) {
            // Ocultar todas las pantallas
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Mostrar la pantalla seleccionada
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
            
            // Actualizar navegación
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activar el tab correspondiente
            const activeTab = document.querySelector(`[data-screen="${screenId}"]`);
            if (activeTab && activeTab.classList.contains('nav-tab')) {
                activeTab.classList.add('active');
            }
            
            currentSection = screenId;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Navegación por tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const screenId = this.dataset.screen;
                    showScreen(screenId);
                });
            });

            // Navegación por botones de acción
            document.querySelectorAll('.action-card').forEach(card => {
                card.addEventListener('click', function() {
                    const screenId = this.dataset.screen;
                    showScreen(screenId);
                });
            });

            // Botón de grabación de audio
            const recordBtn = document.getElementById('recordBtn');
            if (recordBtn) {
                recordBtn.addEventListener('click', toggleRecording);
            }

            // Botón de enviar reporte
            const submitBtn = document.getElementById('submitReportBtn');
            if (submitBtn) {
                submitBtn.addEventListener('click', submitReport);
            }
        });

        // Función para expandir cámaras
        function expandCamera(type) {
            const expandedView = document.getElementById('expandedView');
            const expandedCamera = document.getElementById('expandedCamera');
            
            // Limpiar clases previas
            expandedCamera.className = 'expanded-camera';
            
            // Agregar clase específica
            expandedCamera.classList.add(`camera-expanded-${type}`);
            
            // Mostrar vista expandida
            expandedView.style.display = 'flex';
        }

        function closeCamera() {
            const expandedView = document.getElementById('expandedView');
            expandedView.style.display = 'none';
        }

        // Función para grabar audio
        function toggleRecording() {
            const audioBtn = document.getElementById('recordBtn');
            const audioTime = document.getElementById('audioTime');
            
            if (!audioBtn || !audioTime) {
                console.error('Audio elements not found');
                return;
            }
            
            if (!isRecording) {
                // Start recording
                isRecording = true;
                recordingTime = 0;
                audioBtn.textContent = '⏹️';
                audioBtn.style.background = '#ef4444';
                audioBtn.style.transform = 'scale(1.1)';
                audioBtn.style.boxShadow = '0 0 10px rgba(239, 68, 68, 0.5)';
                
                console.log('Started recording simulation');
                
                recordingInterval = setInterval(() => {
                    recordingTime++;
                    const minutes = Math.floor(recordingTime / 60);
                    const seconds = recordingTime % 60;
                    audioTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    audioTime.style.color = '#ef4444';
                    audioTime.style.fontWeight = 'bold';
                }, 1000);
            } else {
                // Stop recording
                isRecording = false;
                audioBtn.textContent = '🎤';
                audioBtn.style.background = '#3b82f6';
                audioBtn.style.transform = 'scale(1)';
                audioBtn.style.boxShadow = 'none';
                audioTime.style.color = '#6b7280';
                audioTime.style.fontWeight = 'normal';
                clearInterval(recordingInterval);
                
                console.log('Stopped recording simulation. Duration:', recordingTime, 'seconds');
                
                // Show recording saved message
                if (recordingTime > 0) {
                    alert(`🎤 Grabación guardada\n\nDuración: ${Math.floor(recordingTime / 60)}:${(recordingTime % 60).toString().padStart(2, '0')}`);
                }
            }
        }

        // Make recording function global
        window.toggleRecording = toggleRecording;

        // Función para enviar reporte
        function submitReport() {
            const camera = document.getElementById('cameraSelect').value;
            const location = document.getElementById('locationInput').value;
            const description = document.getElementById('descriptionInput').value;
            
            if (!camera || camera === 'Seleccionar cámara') {
                alert('Por favor selecciona una cámara.');
                return;
            }
            
            if (!location.trim()) {
                alert('Por favor ingresa la ubicación del incidente.');
                return;
            }
            
            if (!description.trim()) {
                alert('Por favor describe el incidente.');
                return;
            }
            
            const btn = document.getElementById('submitReportBtn');
            const originalText = btn.textContent;
            
            btn.textContent = 'Enviando...';
            btn.disabled = true;
            btn.style.background = '#9ca3af';
            
            setTimeout(() => {
                btn.textContent = '✓ Enviado';
                btn.style.background = '#10b981';
                
                // Show success notification
                alert('✅ Reporte enviado exitosamente\n\nTu reporte ha sido registrado y será revisado por el equipo de seguridad.');
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.disabled = false;
                    btn.style.background = '#1e3a8a';
                    
                    // Limpiar formulario
                    document.getElementById('cameraSelect').value = 'Seleccionar cámara';
                    document.getElementById('locationInput').value = '';
                    document.getElementById('descriptionInput').value = '';
                    
                    // Limpiar fotos seleccionadas
                    selectedPhotos = [];
                    updatePhotoPreview();
                    
                    // Reset audio recording state
                    const audioBtn = document.getElementById('recordBtn');
                    const audioTime = document.getElementById('audioTime');
                    if (isRecording) {
                        isRecording = false;
                        clearInterval(recordingInterval);
                    }
                    audioBtn.textContent = '🎤';
                    audioBtn.style.background = '#3b82f6';
                    audioTime.textContent = '00:00';
                    
                    showScreen('dashboard');
                }, 1500);
            }, 2000);
        }

        // Make submit function global
        window.submitReport = submitReport;
        
        // Test functions are working
        console.log('submitReport function defined:', typeof window.submitReport);
        console.log('toggleRecording function defined:', typeof window.toggleRecording);

        // Funciones de emergencia
        function emergencyCall(type) {
            const messages = {
                policia: '🚔 LLAMADA DE EMERGENCIA - POLICÍA\n\nConectando con 911...\nTiempo estimado de respuesta: 5-8 minutos',
                ambulancia: '🚑 LLAMADA DE EMERGENCIA - AMBULANCIA\n\nConectando con 911...\nTiempo estimado de respuesta: 6-10 minutos',
                bomberos: '🚒 LLAMADA DE EMERGENCIA - BOMBEROS\n\nConectando con 911...\nTiempo estimado de respuesta: 4-7 minutos',
                seguridad: '🛡️ LLAMADA A SEGURIDAD LOCAL\n\nConectando con equipo de seguridad...\nTiempo estimado de respuesta: 2-5 minutos'
            };
            
            if (confirm(`¿Confirmas que deseas realizar esta llamada de emergencia?`)) {
                alert(messages[type]);
            }
        }

        function panicAlert() {
            if (confirm('¿Confirmas que deseas activar la ALERTA DE PÁNICO?')) {
                alert('🚨 ALERTA DE PÁNICO ACTIVADA\n\nSe ha enviado tu ubicación a:\n• Contactos de emergencia\n• Autoridades locales\n• Sistema de seguridad\n\nAyuda en camino.');
            }
        }

        function quickReport() {
            alert('📸 Captura realizada\nFecha: ' + new Date().toLocaleString() + '\nCámara: Expandida\n\nImagen guardada en reportes.');
        }

        function emergencyReport() {
            if (confirm('¿Deseas enviar un reporte de emergencia desde esta cámara?')) {
                alert('🚨 REPORTE DE EMERGENCIA ENVIADO\n\nUbicación: Cámara actual\nHora: ' + new Date().toLocaleTimeString() + '\n\nAutoridades notificadas.');
            }
        }

        // Función para mostrar pantalla de recompensas
        function showRewards() {
            showScreen('recompensas');
        }

        // Función para canjear recompensas
        function claimReward(type) {
            const rewards = {
                cafe: {
                    name: 'Descuento Cafetería',
                    points: 500,
                    description: '15% descuento en Café Central'
                },
                pizza: {
                    name: 'Descuento Comida',
                    points: 600,
                    description: '10% en Pizza Express'
                }
            };
            
            const reward = rewards[type];
            const currentPoints = 680; // Puntos actuales del usuario
            
            if (currentPoints >= reward.points) {
                if (confirm(`¿Confirmas que deseas canjear ${reward.points} puntos por:\n${reward.name}\n${reward.description}?`)) {
                    alert(`🎉 ¡Recompensa canjeada exitosamente!\n\n${reward.name}\n${reward.description}\n\nCódigo: ALU${Math.random().toString(36).substr(2, 6).toUpperCase()}\n\nPuntos restantes: ${currentPoints - reward.points}`);
                }
            } else {
                alert(`No tienes suficientes puntos para esta recompensa.\nNecesitas: ${reward.points} puntos\nTienes: ${currentPoints} puntos`);
            }
        }

        // Cerrar cámara con ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeCamera();
            }
        });

        // Cerrar al hacer clic fuera
        document.getElementById('expandedView').addEventListener('click', function(event) {
            if (event.target === this) {
                closeCamera();
            }
        });

        // Variables globales para autenticación
        let isLoggedIn = false;
        let currentUser = null;

        // Función para manejar el login
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;

            if (!email || !password) {
                alert('Por favor ingresa tu email y contraseña.');
                return;
            }

            const loginBtn = document.getElementById('loginBtn');
            const originalText = loginBtn.textContent;
            
            loginBtn.textContent = 'Verificando...';
            loginBtn.disabled = true;
            loginBtn.style.background = '#9ca3af';

            // Simular autenticación
            setTimeout(() => {
                // Demo user credentials
                if (email === 'demo' && password === 'demo') {
                    currentUser = {
                        name: 'Juan Pérez',
                        email: 'demo',
                        phone: '+1 234 567 8900',
                        address: 'Calle 123, Colonia Centro',
                        verified: true,
                        level: 'Principiante',
                        reports: 12,
                        points: 680,
                        daysActive: 45,
                        ranking: 15
                    };
                    
                    isLoggedIn = true;
                    
                    if (rememberMe) {
                        localStorage.setItem('alertaUrbanaUser', JSON.stringify(currentUser));
                        localStorage.setItem('alertaUrbanaLoggedIn', 'true');
                    }
                    
                    updateUserProfile();
                    showMainApp();
                    
                    loginBtn.textContent = '✓ Acceso exitoso';
                    loginBtn.style.background = '#10b981';
                    
                    setTimeout(() => {
                        loginBtn.textContent = originalText;
                        loginBtn.disabled = false;
                        loginBtn.style.background = '#1e3a8a';
                        
                        // Limpiar formulario
                        document.getElementById('loginEmail').value = '';
                        document.getElementById('loginPassword').value = '';
                        document.getElementById('rememberMe').checked = false;
                    }, 1500);
                } else {
                    alert('Credenciales incorrectas. Usa:\nEmail: demo\nContraseña: demo');
                    
                    loginBtn.textContent = originalText;
                    loginBtn.disabled = false;
                    loginBtn.style.background = '#1e3a8a';
                }
            }, 2000);
        }

        // Función para manejar el registro
        function handleRegister() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const address = document.getElementById('registerAddress').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const acceptTerms = document.getElementById('acceptTerms').checked;

            // Validaciones
            if (!name || !email || !phone || !address || !password || !confirmPassword) {
                alert('Por favor completa todos los campos.');
                return;
            }

            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden.');
                return;
            }

            if (password.length < 6) {
                alert('La contraseña debe tener al menos 6 caracteres.');
                return;
            }

            if (!acceptTerms) {
                alert('Debes aceptar los términos y condiciones.');
                return;
            }

            const registerBtn = document.getElementById('registerBtn');
            const originalText = registerBtn.textContent;
            
            registerBtn.textContent = 'Creando cuenta...';
            registerBtn.disabled = true;
            registerBtn.style.background = '#9ca3af';

            // Simular registro
            setTimeout(() => {
                currentUser = {
                    name: name,
                    email: email,
                    phone: phone,
                    address: address,
                    verified: false, // Los nuevos usuarios necesitan verificación
                    level: 'Nuevo',
                    reports: 0,
                    points: 0,
                    daysActive: 1,
                    ranking: 156
                };
                
                isLoggedIn = true;
                
                // Guardar en localStorage
                localStorage.setItem('alertaUrbanaUser', JSON.stringify(currentUser));
                localStorage.setItem('alertaUrbanaLoggedIn', 'true');
                
                registerBtn.textContent = '✓ Cuenta creada';
                registerBtn.style.background = '#10b981';
                
                alert('¡Cuenta creada exitosamente!\n\nHemos enviado un código de verificación a tu email.\nRevisa tu bandeja de entrada para verificar tu cuenta.');
                
                setTimeout(() => {
                    updateUserProfile();
                    showMainApp();
                    
                    registerBtn.textContent = originalText;
                    registerBtn.disabled = false;
                    registerBtn.style.background = '#1e3a8a';
                    
                    // Limpiar formulario
                    document.getElementById('registerName').value = '';
                    document.getElementById('registerEmail').value = '';
                    document.getElementById('registerPhone').value = '';
                    document.getElementById('registerAddress').value = '';
                    document.getElementById('registerPassword').value = '';
                    document.getElementById('registerConfirmPassword').value = '';
                    document.getElementById('acceptTerms').checked = false;
                }, 2000);
            }, 2500);
        }

        // Función para mostrar la aplicación principal
        function showMainApp() {
            document.getElementById('mainNavigation').style.display = 'flex';
            showScreen('dashboard');
        }

        // Función para actualizar el perfil del usuario
        function updateUserProfile() {
            if (currentUser) {
                // Actualizar avatar con iniciales
                const initials = currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                document.getElementById('userAvatar').textContent = initials;
                
                // Actualizar información del perfil
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;
                document.getElementById('userPhone').textContent = currentUser.phone;
                document.getElementById('userAddress').textContent = currentUser.address;
                
                // Actualizar estadísticas
                const statsElements = document.querySelector('#profile .content').querySelectorAll('[style*="font-size: 24px"]');
                if (statsElements.length >= 4) {
                    statsElements[0].textContent = currentUser.reports;
                    statsElements[1].textContent = currentUser.points;
                    statsElements[2].textContent = currentUser.daysActive;
                    statsElements[3].textContent = currentUser.ranking;
                }
                
                // Actualizar estado de verificación
                const verificationBadge = document.querySelector('#profile .content span[style*="background: #10b981"]');
                if (verificationBadge) {
                    if (currentUser.verified) {
                        verificationBadge.textContent = '✓ VERIFICADO';
                        verificationBadge.style.background = '#10b981';
                    } else {
                        verificationBadge.textContent = '⏳ PENDIENTE';
                        verificationBadge.style.background = '#f59e0b';
                    }
                }
            }
        }

        // Función para editar perfil
        function editProfile() {
            alert('Función de editar perfil en desarrollo.\n\nPróximamente podrás actualizar tu información personal, foto de perfil y configuraciones de seguridad.');
        }

        // Función para cerrar sesión
        function logout() {
            if (confirm('¿Estás seguro que deseas cerrar sesión?')) {
                isLoggedIn = false;
                currentUser = null;
                
                // Limpiar localStorage
                localStorage.removeItem('alertaUrbanaUser');
                localStorage.removeItem('alertaUrbanaLoggedIn');
                
                // Ocultar navegación principal
                document.getElementById('mainNavigation').style.display = 'none';
                
                // Mostrar pantalla de login
                showScreen('login');
                
                alert('Sesión cerrada exitosamente.');
            }
        }

        // Verificar si hay sesión guardada al cargar la página
        function checkSavedSession() {
            const savedUser = localStorage.getItem('alertaUrbanaUser');
            const savedLoggedIn = localStorage.getItem('alertaUrbanaLoggedIn');
            
            if (savedUser && savedLoggedIn === 'true') {
                currentUser = JSON.parse(savedUser);
                isLoggedIn = true;
                updateUserProfile();
                showMainApp();
            }
        }

        // Variables para el sistema de alertas
        let alertsData = [
            { id: 'alert_critical_1', severity: 'high', status: 'pending', title: '🚨 Intrusión Detectada', location: 'Perímetro principal - Cámara 01', time: '15:23', timestamp: Date.now() - 2*60*1000 },
            { id: 'alert1', severity: 'high', status: 'pending', title: 'Movimiento Detectado', location: 'Zona residencial - Cámara 03', time: '13:45', timestamp: Date.now() - 12*60*1000 },
            { id: 'alert2', severity: 'medium', status: 'pending', title: 'Vehículo No Autorizado', location: 'Estacionamiento - Cámara 01', time: '12:30', timestamp: Date.now() - 75*60*1000 },
            { id: 'alert3', severity: 'low', status: 'acknowledged', title: 'Persona Sospechosa', location: 'Entrada principal - Cámara 01', time: '11:15', timestamp: Date.now() - 150*60*1000 },
            { id: 'alert4', severity: 'medium', status: 'pending', title: 'Puerta Abierta Detectada', location: 'Acceso lateral - Sensor 02', time: '10:00', timestamp: Date.now() - 225*60*1000 },
            { id: 'alert5', severity: 'low', status: 'acknowledged', title: 'Actividad Normal', location: 'Patrullaje de seguridad - Cámara 02', time: '08:25', timestamp: Date.now() - 320*60*1000 }
        ];

        // Función para reconocer alertas
        function acknowledgeAlert(alertId) {
            console.log('acknowledgeAlert called:', alertId);
            
            // Buscar el elemento de alerta
            var alertElement = document.querySelector('[onclick*="' + alertId + '"]');
            if (!alertElement) {
                console.error('Alert element not found for:', alertId);
                alert('Error: No se encontró la alerta');
                return;
            }
            
            var alertItem = alertElement.closest('.alert-item');
            if (!alertItem) {
                console.error('Alert item not found');
                return;
            }
            
            var alertBtn = alertItem.querySelector('.alert-btn');
            if (!alertBtn) {
                console.error('Alert button not found');
                return;
            }
            
            // Si ya está reconocida, no hacer nada
            if (alertBtn.classList.contains('acknowledged')) {
                console.log('Alert already acknowledged');
                return;
            }
            
            // Marcar como reconocida visualmente
            alertItem.classList.add('acknowledged');
            alertItem.setAttribute('data-status', 'acknowledged');
            alertBtn.classList.add('acknowledged');
            alertBtn.onclick = null;
            
            // Mostrar confirmación
            var alertTitle = alertItem.querySelector('h3').textContent;
            alert('✅ Alerta reconocida: ' + alertTitle);
            
            // Actualizar filtros si existen
            if (window.applyAllFilters) {
                window.applyAllFilters();
            }
            
            console.log('Alert acknowledged successfully');
        }

        // Hacer función global inmediatamente
        window.acknowledgeAlert = acknowledgeAlert;

        // Función para ver detalles de alerta
        function viewAlertDetails(alertId) {
            const alert = alertsData.find(a => a.id === alertId);
            if (!alert) return;
            
            const details = `
DETALLES DE LA ALERTA

📍 Ubicación: ${alert.location}
⏰ Hora: ${alert.time}
🔴 Severidad: ${alert.severity.toUpperCase()}
📋 Estado: ${alert.status === 'pending' ? 'PENDIENTE' : 'ATENDIDA'}

Descripción: ${alert.title}

Acciones disponibles:
• Ver grabación de cámara
• Enviar equipo de seguridad
• Notificar a autoridades
• Crear reporte de incidente
            `;
            
            alert(details);
        }

        // Variables globales para manejo de filtros y búsqueda
        var currentFilters = {
            severity: 'all',
            status: 'all',
            time: 'all',
            search: ''
        };

        // Función para filtrar alertas
        function filterAlerts(filter, type) {
            console.log('filterAlerts called:', filter, type);
            
            if (!type) type = 'severity'; // default value
            
            // Actualizar filtro actual
            currentFilters[type] = filter;
            
            // Actualizar botones de filtro del tipo específico
            var buttons = document.querySelectorAll('[data-type="' + type + '"]');
            buttons.forEach(function(btn) {
                btn.classList.remove('active');
            });
            
            var activeBtn = document.querySelector('[data-filter="' + filter + '"][data-type="' + type + '"]');
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // Aplicar todos los filtros
            applyAllFilters();
        }

        function searchAlerts(searchTerm) {
            currentFilters.search = searchTerm.toLowerCase();
            
            // Mostrar/ocultar botón de limpiar búsqueda
            var clearBtn = document.getElementById('clearSearchBtn');
            if (clearBtn) {
                clearBtn.style.display = searchTerm ? 'block' : 'none';
            }
            
            applyAllFilters();
        }

        function clearSearch() {
            var searchInput = document.getElementById('alertSearch');
            if (searchInput) {
                searchInput.value = '';
            }
            currentFilters.search = '';
            var clearBtn = document.getElementById('clearSearchBtn');
            if (clearBtn) {
                clearBtn.style.display = 'none';
            }
            applyAllFilters();
        }

        function applyAllFilters() {
            var alertItems = document.querySelectorAll('#alertsList .alert-item');
            var visibleCount = 0;
            
            alertItems.forEach(function(item) {
                var show = true;
                
                // Filtro por severidad
                if (currentFilters.severity !== 'all') {
                    show = show && item.getAttribute('data-severity') === currentFilters.severity;
                }
                
                // Filtro por estado
                if (currentFilters.status !== 'all') {
                    show = show && item.getAttribute('data-status') === currentFilters.status;
                }
                
                // Filtro por tiempo
                if (currentFilters.time !== 'all') {
                    var timeElements = item.querySelectorAll('span');
                    var timeText = '';
                    for (var i = 0; i < timeElements.length; i++) {
                        var el = timeElements[i];
                        if (el.textContent.includes('min') || el.textContent.includes('h')) {
                            timeText = el.textContent;
                            break;
                        }
                    }
                    
                    switch(currentFilters.time) {
                        case 'hour':
                            show = show && (timeText.includes('min') || timeText.includes('hace 1h'));
                            break;
                        case 'today':
                            show = show && (timeText.includes('min') || timeText.includes('h'));
                            break;
                        case 'week':
                            show = true; // Para el demo, mostramos todo como "esta semana"
                            break;
                    }
                }
                
                // Filtro por búsqueda
                if (currentFilters.search) {
                    var title = item.querySelector('h3').textContent.toLowerCase();
                    var description = item.querySelector('p').textContent.toLowerCase();
                    show = show && (title.includes(currentFilters.search) || description.includes(currentFilters.search));
                }
                
                item.style.display = show ? 'flex' : 'none';
                if (show) visibleCount++;
            });
            
            // Actualizar contador
            updateAlertsCounter(visibleCount, alertItems.length);
        }

        function updateAlertsCounter(visible, total) {
            var alertsCount = document.getElementById('alertsCount');
            var totalAlerts = document.getElementById('totalAlerts');
            var counter = document.getElementById('alertsCounter');
            
            if (alertsCount) alertsCount.textContent = visible;
            if (totalAlerts) totalAlerts.textContent = total;
            
            if (counter) {
                if (visible === total) {
                    counter.style.color = '#6b7280';
                } else {
                    counter.style.color = '#3b82f6';
                }
            }
        }

        // Hacer funciones globales inmediatamente
        window.filterAlerts = filterAlerts;
        window.searchAlerts = searchAlerts;
        window.clearSearch = clearSearch;
        window.applyAllFilters = applyAllFilters;
        window.updateAlertsCounter = updateAlertsCounter;

        // Función para mostrar notificaciones
        function showNotification(message) {
            // Crear elemento de notificación
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #1f2937;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                font-size: 14px;
                z-index: 1000;
                max-width: 300px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                transform: translateX(400px);
                transition: transform 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Mostrar notificación
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Ocultar después de 3 segundos
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Función para actualizar contadores de alertas
        function updateAlertCounters() {
            const pending = alertsData.filter(a => a.status === 'pending').length;
            const acknowledged = alertsData.filter(a => a.status === 'acknowledged').length;
            
            // Actualizar estadísticas en dashboard si está visible
            if (document.getElementById('dashboard').classList.contains('active')) {
                const statsElements = document.querySelectorAll('.stat-number');
                if (statsElements.length >= 2) {
                    statsElements[1].textContent = pending; // Alertas hoy
                }
            }
        }

        // Simular nuevas alertas automáticas
        function simulateNewAlert() {
            if (!isLoggedIn) return;
            
            const newAlerts = [
                { title: '🚗 Vehículo Sospechoso', location: 'Entrada principal - Cámara 01', severity: 'medium' },
                { title: '🚶 Actividad Nocturna', location: 'Perímetro - Cámara 02', severity: 'low' },
                { title: '🔓 Acceso No Autorizado', location: 'Puerta trasera - Sensor 03', severity: 'high' },
                { title: '📦 Objeto Abandonado', location: 'Zona común - Cámara 03', severity: 'medium' }
            ];
            
            const randomAlert = newAlerts[Math.floor(Math.random() * newAlerts.length)];
            const now = new Date();
            const timeString = now.toLocaleTimeString('es', { hour: '2-digit', minute: '2-digit' });
            
            // Agregar nueva alerta
            const newAlertData = {
                id: 'alert_' + Date.now(),
                severity: randomAlert.severity,
                status: 'pending',
                title: randomAlert.title,
                location: randomAlert.location,
                time: timeString,
                timestamp: Date.now()
            };
            
            alertsData.unshift(newAlertData);
            
            // Mostrar notificación push
            showNotification(`🚨 Nueva alerta: ${randomAlert.title}`);
            
            // Actualizar contadores
            updateAlertCounters();
            
            // Si estamos en la pantalla de alertas, actualizar la vista
            if (document.getElementById('alerts').classList.contains('active')) {
                // Aquí podrías actualizar dinámicamente la lista de alertas
                console.log('Nueva alerta agregada:', newAlertData);
            }
        }

        // Configurar simulación de alertas automáticas cada 2-5 minutos
        function startAlertSimulation() {
            setInterval(() => {
                if (Math.random() < 0.3) { // 30% de probabilidad cada intervalo
                    simulateNewAlert();
                }
            }, 120000); // Cada 2 minutos
        }

        // Asegurar que las funciones críticas estén en el scope global
        window.handleLogin = handleLogin;
        window.handleRegister = handleRegister;
        window.showScreen = showScreen;
        window.removePhoto = removePhoto;
        // Functions already assigned to window above

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            alert('JavaScript is working! Check console for more details.');
            
            // Login y registro botones - prioridad máxima
            const loginBtn = document.getElementById('loginBtn');
            console.log('Login button found:', loginBtn);
            if (loginBtn) {
                loginBtn.addEventListener('click', function() {
                    console.log('Login button clicked');
                    handleLogin();
                });
            }
            
            const registerBtn = document.getElementById('registerBtn');
            console.log('Register button found:', registerBtn);
            if (registerBtn) {
                registerBtn.addEventListener('click', function() {
                    console.log('Register button clicked');
                    handleRegister();
                });
            }
            
            // Links de navegación
            const registerLink = document.getElementById('registerLink');
            if (registerLink) {
                registerLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showScreen('register');
                });
            }
            
            const loginLink = document.getElementById('loginLink');
            if (loginLink) {
                loginLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showScreen('login');
                });
            }
            
            checkSavedSession();
            
            // Iniciar simulación de alertas solo si está logueado
            if (isLoggedIn) {
                startAlertSimulation();
            }
            
            // Navegación por tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const screenId = this.dataset.screen;
                    showScreen(screenId);
                });
            });

            // Navegación por botones de acción
            document.querySelectorAll('.action-card').forEach(card => {
                card.addEventListener('click', function() {
                    const screenId = this.dataset.screen;
                    showScreen(screenId);
                });
            });

            // Botón de grabación de audio
            const recordBtn = document.getElementById('recordBtn');
            if (recordBtn) {
                recordBtn.addEventListener('click', toggleRecording);
            }

            // Botón de enviar reporte
            const submitBtn = document.getElementById('submitReportBtn');
            if (submitBtn) {
                submitBtn.addEventListener('click', submitReport);
            }
            
            // Inicializar contador de alertas cuando la página esté lista
            setTimeout(() => {
                if (document.getElementById('alertsList')) {
                    const totalAlerts = document.querySelectorAll('#alertsList .alert-item').length;
                    if (window.updateAlertsCounter) {
                        window.updateAlertsCounter(totalAlerts, totalAlerts);
                    }
                }
            }, 500);

            // Mobile keyboard handling with Visual Viewport API
            let isKeyboardOpen = false;
            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            console.log('Browser detection - Safari:', isSafari, 'User Agent:', navigator.userAgent);
            
            // Add Safari class to body for CSS targeting
            if (isSafari) {
                document.body.classList.add('safari-browser');
            }
            
            function handleKeyboardOpen() {
                if (!isKeyboardOpen) {
                    isKeyboardOpen = true;
                    document.body.classList.add('keyboard-open');
                    if (isSafari) {
                        document.body.classList.add('safari-keyboard');
                    }
                    console.log('Keyboard opened - switching to scroll layout (Safari:', isSafari, ')');
                }
            }
            
            function handleKeyboardClose() {
                if (isKeyboardOpen) {
                    isKeyboardOpen = false;
                    document.body.classList.remove('keyboard-open');
                    document.body.classList.remove('safari-keyboard');
                    console.log('Keyboard closed - switching to fixed layout');
                    
                    // Scroll to top to ensure proper positioning, with longer delay for Safari
                    setTimeout(() => {
                        window.scrollTo(0, 0);
                    }, isSafari ? 300 : 100);
                }
            }

            // Use Visual Viewport API if available (better for iOS)
            if (window.visualViewport) {
                window.visualViewport.addEventListener('resize', () => {
                    const heightDiff = window.innerHeight - window.visualViewport.height;
                    if (heightDiff > 100) {
                        handleKeyboardOpen();
                    } else {
                        handleKeyboardClose();
                    }
                });
            }
            
            // Fallback for older browsers
            let initialHeight = window.innerHeight;
            window.addEventListener('resize', () => {
                const currentHeight = window.innerHeight;
                const heightDiff = initialHeight - currentHeight;
                if (heightDiff > 150) {
                    handleKeyboardOpen();
                } else {
                    handleKeyboardClose();
                }
            });
            
            // Input focus/blur events as additional triggers
            document.addEventListener('focusin', function(e) {
                if (e.target.type === 'email' || e.target.type === 'password' || e.target.type === 'text' || e.target.tagName === 'TEXTAREA') {
                    setTimeout(handleKeyboardOpen, 300);
                }
            });
            
            document.addEventListener('focusout', function() {
                // Only close if no other input is focused
                setTimeout(() => {
                    const activeElement = document.activeElement;
                    if (!activeElement || (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA')) {
                        handleKeyboardClose();
                    }
                }, 100);
            });
        });
</body>
</html>